{% schema %}
{
  "name": "Testimonials",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Customer Testimonials"
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "text",
          "id": "name",
          "label": "Name",
          "default": "John Doe"
        },
        {
          "type": "textarea",
          "id": "testimonial",
          "label": "Testimonial",
          "default": "This is an amazing product!"
        },
        {
          "type": "number",
          "id": "rating",
          "label": "Rating (1-5)"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials",
      "category": "Custom"
    }
  ]
}
{% endschema %}

<div class="testimonial-section" style="width: 100%; max-width: 1270px; margin: auto; position: relative;margin-bottom: 40px;margin-top: 40px;">
  <h2 style="text-align: center;">{{ section.settings.heading }}</h2>
  <div class="testimonials-wrapper">
    {% for block in section.blocks %}
      {% if block.type == 'testimonial' %}
        <div class="testimonial">
          {% if block.settings.image != blank %}
            <img src="{{ block.settings.image | img_url: 'medium' }}" alt="{{ block.settings.name }}" class="testimonial-image">
          {% endif %}
          <p class="testimonial-text">{{ block.settings.testimonial }}</p>
          <div class="testimonial-rating">
            {% assign rating = block.settings.rating %}
            {% for i in (1..5) %}
              {% if i <= rating %}
                <span class="star">&#9733;</span>
              {% else %}
                <span class="star empty">&#9734;</span>
              {% endif %}
            {% endfor %}
          </div>
          <p class="testimonial-name">{{ block.settings.name }}</p>
        </div>
      {% endif %}
    {% endfor %}
  </div>
 {% comment %} 
  <button class="arrow prev" onclick="scrollTestimonials('prev')">&#10094;</button>
  <button class="arrow next" onclick="scrollTestimonials('next')">&#10095;</button>
  {% endcomment %}
  <div class="dots-wrapper">
    {% for block in section.blocks %}
      {% if block.type == 'testimonial' %}
        <span class="dot" onclick="currentSlide({{ forloop.index }})"></span>
      {% endif %}
    {% endfor %}
  </div>
  
</div>

<style>
/* Hide the scrollbar */
.testimonials-wrapper {
  display: flex;
  flex-wrap: nowrap;
  overflow-x: auto;
  gap: 20px;
  padding-bottom: 8px;
  -webkit-overflow-scrolling: touch;
  position: relative;
}

.testimonials-wrapper::-webkit-scrollbar {
  display: none; /* Hide scrollbar for WebKit browsers */
}

.testimonials-wrapper {
  -ms-overflow-style: none;  /* IE and Edge */
  scrollbar-width: none;  /* Firefox */
}

.testimonial {
  flex: 1 0 32%;
  max-width: 100%;
  background-color: #f9f9f9;
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 20px;
  box-shadow: 0px 6px 4px 0px rgb(0 0 0 / 10%);
  text-align: center;
  
}
.testimonial-image {
  max-width: 100px;
  max-height: 100px;
  border-radius: 50%;
  margin: 0 auto 10px;
}

.testimonial-text {
  margin-bottom: 10px;
}

.testimonial-rating {
  display: flex;
  justify-content: center;
  margin-bottom: 10px;
}

.star {
  color: gold;
  margin: 0 2px;
}

.star.empty {
  color: #ddd;
}

.testimonial-name {
  font-weight: bold;
}
 {% comment %}  
.arrow {
  cursor: pointer;
  position: absolute;
  top: 50%;
  width: auto;
  padding: 4px 10px 4px 10px;;
  margin-top: -12px;
  color: white;
  font-weight: bold;
  font-size: 14px;
  transition: 0.6s ease;
  border-radius: 50%;
  user-select: none;
  background-color: #471100;
  z-index: 10; /* Ensure the arrows are on top */
}

.prev {
  left: 0;
}

.next {
  right: 0;
}

.dots-wrapper {
  text-align: center;
  padding: 0px;
}

.dot {
  cursor: pointer;
  height: 10px;
  width: 10px;
  margin: 0 2px;
  background-color: #bbb;
  border-radius: 50%;
  display: inline-block;
  transition: background-color 0.6s ease;
}

.dot.active {
  background-color: #717171;
}
{% endcomment %}
/* Media query for mobile devices */
@media (max-width: 767px) {
  .testimonials-wrapper {
    flex-wrap: nowrap;
    justify-content: flex-start;
    margin-right: 24px !important;
  }

  .testimonial {
    flex: 0 0 100%;
    max-width: 100%;
  }

  .testimonial-section {
    width: 100% !important;
    max-width: 1270px !important;
    margin-left: 12px !important;
  }
{% comment %}
  .arrow {
    font-size: 12px;
    padding: 10px;
    display:none;
  }
{% endcomment %}
  .dot {
    height: 10px;
    width: 10px;
  }
  .dot {
  cursor: pointer;
  height: 10px;
  width: 10px;
  margin: 0 2px;
  background-color: #bbb;
  border-radius: 50%;
  display: inline-block;
  transition: background-color 0.6s ease;
}
.dots-wrapper {
  text-align: center;
  padding: 0px;
}
.dot.active {
  background-color: #717171;
}
}
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const testimonialWrapper = document.querySelector('.testimonials-wrapper');
    let currentIndex = 0;

    if (testimonialWrapper) {
      testimonialWrapper.style.scrollSnapType = 'x mandatory';

      const testimonials = testimonialWrapper.querySelectorAll('.testimonial');
      testimonials.forEach(testimonial => {
        testimonial.style.scrollSnapAlign = 'start';
      });

      // Function to update the active dot
      function updateDots() {
        const dots = document.querySelectorAll('.dot');
        dots.forEach((dot, index) => {
          if (index === currentIndex) {
            dot.classList.add('active');
          } else {
            dot.classList.remove('active');
          }
        });
      }

      // Function to scroll to a specific slide
      function currentSlide(index) {
        currentIndex = index - 1;
        testimonialWrapper.scrollLeft = testimonials[currentIndex].offsetLeft;
        updateDots();
      }

      // Function to scroll testimonials
      function scrollTestimonials(direction) {
        if (direction === 'next') {
          currentIndex = (currentIndex + 1) % testimonials.length;
        } else {
          currentIndex = (currentIndex - 1 + testimonials.length) % testimonials.length;
        }
        testimonialWrapper.scrollLeft = testimonials[currentIndex].offsetLeft;
        updateDots();
      }

      // Attach functions to the window object for button and dot onclick events
      window.scrollTestimonials = scrollTestimonials;
      window.currentSlide = currentSlide;

      // Initialize dots
      updateDots();
    }
  });
</script>
